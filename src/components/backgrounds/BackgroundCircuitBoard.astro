---
interface Props {
    color?: string;
    opacity?: number;
    animated?: boolean;
}

const {
    color = 'rgba(34, 211, 238, 0.4)', // cyan-400
    opacity = 0.15,
    animated = true
} = Astro.props;
---

<div class="circuit-board-bg" aria-hidden="true">
    <svg class="circuit-svg" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid slice">
        <defs>
            <!-- Circuit pattern -->
            <pattern id="circuit-pattern" x="0" y="0" width="200" height="150" patternUnits="userSpaceOnUse">
                <!-- Horizontal lines -->
                <line x1="0" y1="30" x2="60" y2="30" stroke="currentColor" stroke-width="1.5"/>
                <line x1="80" y1="30" x2="200" y2="30" stroke="currentColor" stroke-width="1.5"/>
                <line x1="0" y1="75" x2="120" y2="75" stroke="currentColor" stroke-width="1.5"/>
                <line x1="140" y1="75" x2="200" y2="75" stroke="currentColor" stroke-width="1.5"/>
                <line x1="0" y1="120" x2="40" y2="120" stroke="currentColor" stroke-width="1.5"/>
                <line x1="60" y1="120" x2="160" y2="120" stroke="currentColor" stroke-width="1.5"/>

                <!-- Vertical lines -->
                <line x1="60" y1="30" x2="60" y2="75" stroke="currentColor" stroke-width="1.5"/>
                <line x1="120" y1="75" x2="120" y2="120" stroke="currentColor" stroke-width="1.5"/>
                <line x1="160" y1="30" x2="160" y2="120" stroke="currentColor" stroke-width="1.5"/>

                <!-- Corner turns -->
                <path d="M 60 30 Q 80 30 80 50" fill="none" stroke="currentColor" stroke-width="1.5"/>
                <path d="M 120 75 Q 140 75 140 95" fill="none" stroke="currentColor" stroke-width="1.5"/>

                <!-- Connection nodes -->
                <circle cx="60" cy="30" r="3" fill="currentColor"/>
                <circle cx="120" cy="75" r="3" fill="currentColor"/>
                <circle cx="160" cy="75" r="3" fill="currentColor"/>
                <circle cx="60" cy="120" r="3" fill="currentColor"/>
                <circle cx="160" cy="120" r="3" fill="currentColor"/>

                <!-- Chip/component rectangles -->
                <rect x="70" y="65" width="30" height="20" rx="2" fill="none" stroke="currentColor" stroke-width="1"/>
                <rect x="35" y="110" width="20" height="20" rx="2" fill="none" stroke="currentColor" stroke-width="1"/>
            </pattern>

            <!-- Animated signal dot -->
            {animated && (
                <circle id="signal-dot" r="4" fill="currentColor">
                    <animate attributeName="opacity" values="1;0.3;1" dur="1.5s" repeatCount="indefinite"/>
                </circle>
            )}
        </defs>

        <!-- Main circuit pattern -->
        <rect width="100%" height="100%" fill="url(#circuit-pattern)"/>

        <!-- Animated signals traveling on circuits -->
        {animated && (
            <>
                <use href="#signal-dot" class="signal signal-1">
                    <animateMotion dur="4s" repeatCount="indefinite" path="M 0,30 L 60,30 L 60,75 L 120,75"/>
                </use>
                <use href="#signal-dot" class="signal signal-2">
                    <animateMotion dur="5s" repeatCount="indefinite" path="M 200,75 L 140,75 L 140,120 L 60,120"/>
                </use>
                <use href="#signal-dot" class="signal signal-3">
                    <animateMotion dur="3.5s" repeatCount="indefinite" path="M 160,30 L 160,120 L 200,120"/>
                </use>
            </>
        )}
    </svg>
</div>

<style define:vars={{ color, opacity }}>
    .circuit-board-bg {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
        color: var(--color);
        opacity: var(--opacity);
    }

    .circuit-svg {
        width: 100%;
        height: 100%;
        min-width: 800px;
    }

    .signal {
        filter: drop-shadow(0 0 6px currentColor);
    }

    .signal-1 {
        animation-delay: 0s;
    }

    .signal-2 {
        animation-delay: 1.5s;
    }

    .signal-3 {
        animation-delay: 0.8s;
    }
</style>
