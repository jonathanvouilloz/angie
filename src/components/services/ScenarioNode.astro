---
// Node futuriste pour une problématique client
// Design géométrique avec coins coupés, style sci-fi/gaming
// Draggable avec lignes attachées dynamiquement

interface Props {
  title: string;
  subtitle: string;
  scenarioId: string;
  service: 'dev-web' | 'automatisation' | 'applications';
  position: number; // 0-7 pour les 8 positions
}

const { title, subtitle, scenarioId, service, position } = Astro.props;

// Couleurs par service
const serviceColors = {
  'automatisation': { primary: '#00D9A3', glow: 'rgba(0, 217, 163, 0.4)' },
  'applications': { primary: '#A300D9', glow: 'rgba(163, 0, 217, 0.4)' },
  'dev-web': { primary: '#0096FF', glow: 'rgba(0, 150, 255, 0.4)' }
};

const colors = serviceColors[service];
---

<button
  class="scenario-node"
  data-scenario-id={scenarioId}
  data-service={service}
  data-position={position}
  type="button"
  aria-label={`Découvrir la solution pour: ${title}`}
  style={`--node-color: ${colors.primary}; --node-glow: ${colors.glow}; --anim-delay: ${position * 0.1}s;`}
>
  <!-- Bordure géométrique -->
  <div class="node-border"></div>

  <!-- Contenu -->
  <div class="node-content">
    <div class="node-text">
      <span class="node-title">{title}</span>
      <span class="node-subtitle">{subtitle}</span>
    </div>
  </div>

  <!-- Corner accents -->
  <span class="corner corner-tl"></span>
  <span class="corner corner-tr"></span>
  <span class="corner corner-bl"></span>
  <span class="corner corner-br"></span>

  <!-- Indicateur hover -->
  <span class="node-indicator">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M5 12h14M12 5l7 7-7 7"/>
    </svg>
  </span>
</button>

<style>
  .scenario-node {
    /* Reset */
    border: none;
    font-family: inherit;
    background: transparent;

    /* Layout */
    position: relative;
    display: flex;
    align-items: center;
    padding: 1rem 1.25rem;
    min-width: 220px;
    max-width: 280px;

    /* Interaction */
    cursor: pointer;

    /* Animation d'entrée */
    opacity: 0;
    transform: scale(0.9);
    animation: nodeAppear 0.5s ease-out forwards;
    animation-delay: var(--anim-delay);
  }

  @keyframes nodeAppear {
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Bordure avec clip-path pour coins coupés */
  .node-border {
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.15);
    clip-path: polygon(
      14px 0, calc(100% - 14px) 0,
      100% 14px, 100% calc(100% - 14px),
      calc(100% - 14px) 100%, 14px 100%,
      0 calc(100% - 14px), 0 14px
    );
    transition: all 0.3s ease;
  }

  .scenario-node:hover .node-border {
    background: rgba(255, 255, 255, 0.06);
    border-color: var(--node-color);
    box-shadow:
      0 0 20px var(--node-glow),
      inset 0 0 20px rgba(255, 255, 255, 0.02);
  }

  /* Contenu */
  .node-content {
    position: relative;
    z-index: 2;
    display: flex;
    align-items: center;
    width: 100%;
  }

  .node-text {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    text-align: left;
  }

  .node-title {
    font-size: 0.95rem;
    font-weight: 600;
    color: white;
    line-height: 1.2;
    transition: color 0.3s ease;
  }

  .scenario-node:hover .node-title {
    color: var(--node-color);
  }

  .node-subtitle {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    line-height: 1.3;
    transition: color 0.3s ease;
  }

  .scenario-node:hover .node-subtitle {
    color: rgba(255, 255, 255, 0.7);
  }

  /* Coins accent */
  .corner {
    position: absolute;
    width: 8px;
    height: 8px;
    border-color: var(--node-color);
    border-style: solid;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .scenario-node:hover .corner {
    opacity: 1;
  }

  .corner-tl {
    top: -1px;
    left: -1px;
    border-width: 2px 0 0 2px;
  }

  .corner-tr {
    top: -1px;
    right: -1px;
    border-width: 2px 2px 0 0;
  }

  .corner-bl {
    bottom: -1px;
    left: -1px;
    border-width: 0 0 2px 2px;
  }

  .corner-br {
    bottom: -1px;
    right: -1px;
    border-width: 0 2px 2px 0;
  }

  /* Indicateur */
  .node-indicator {
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%) translateX(-5px);
    color: var(--node-color);
    opacity: 0;
    transition: all 0.3s ease;
  }

  .scenario-node:hover .node-indicator {
    opacity: 1;
    transform: translateY(-50%) translateX(0);
  }

  /* Focus */
  .scenario-node:focus {
    outline: none;
  }

  .scenario-node:focus-visible .node-border {
    border-color: var(--node-color);
    box-shadow: 0 0 0 2px var(--node-glow);
  }

  /* Active */
  .scenario-node:active {
    transform: scale(0.98);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .scenario-node {
      min-width: 180px;
      max-width: 100%;
      padding: 0.875rem 1rem;
    }

    .node-emoji {
      font-size: 1.25rem;
    }

    .node-title {
      font-size: 0.875rem;
    }

    .node-subtitle {
      font-size: 0.7rem;
    }

    .node-indicator {
      display: none;
    }
  }
</style>
