---
import type { CollectionEntry } from 'astro:content';
import { formatDateShort, getCategoryName, getCategoryColor } from '../../lib/blog';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { title, description, category, tags, pubDate, readingTime } = post.data;
const categoryName = getCategoryName(category);
const categoryColor = getCategoryColor(category);
---

<article
  class="post-list-item group py-6 border-b border-gray-200 last:border-b-0 transition-all duration-300"
  data-category={category}
  data-title={title.toLowerCase()}
  data-tags={tags.join(' ').toLowerCase()}
>
  <a href={`/blog/${post.slug}/`} class="block">
    <!-- First line: Category indicator, Title, Reading time, Date -->
    <div class="flex flex-wrap items-center gap-x-3 gap-y-1 mb-2">
      <!-- Subtle category: colored dot + text -->
      <span class="flex items-center gap-1.5 text-xs text-gray-400">
        <span
          class="w-2 h-2 rounded-full flex-shrink-0"
          style={`background-color: ${categoryColor};`}
        ></span>
        {categoryName}
      </span>

      <span class="text-gray-300">Â·</span>

      <h3 class="text-base md:text-lg font-bold group-hover:text-[var(--violet)] transition-colors flex-1 min-w-0">
        {title}
      </h3>

      <div class="flex items-center gap-3 text-xs text-gray-400 flex-shrink-0">
        {readingTime && (
          <span class="flex items-center gap-1">
            <i class="ri-time-line"></i>
            {readingTime} min
          </span>
        )}
        <time datetime={pubDate.toISOString()}>
          {formatDateShort(pubDate)}
        </time>
      </div>
    </div>

    <!-- Second line: Description + Tags -->
    <div class="flex flex-wrap items-center gap-x-4 gap-y-2">
      <p class="text-gray-500 text-sm line-clamp-1 flex-1 min-w-0">
        {description}
      </p>

      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2 flex-shrink-0">
          {tags.slice(0, 3).map((tag) => (
            <span class="text-xs text-gray-400">
              #{tag}
            </span>
          ))}
        </div>
      )}
    </div>
  </a>
</article>
