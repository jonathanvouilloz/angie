---
import type { CollectionEntry } from 'astro:content';
import CategoryBadge from './CategoryBadge.astro';
import { formatDateShort } from '../../lib/blog';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { title, description, image, category, tags, pubDate, readingTime } = post.data;
---

<article
  class="post-card group relative bg-[#FBFBFB] border-2 border-black shadow-[4px_4px_0px_rgba(0,0,0,0.3)] overflow-hidden transition-all duration-200 hover:shadow-[2px_2px_0px_rgba(0,0,0,1)] hover:translate-x-[2px] hover:translate-y-[2px]"
  data-title={title.toLowerCase()}
  data-tags={tags.join(' ').toLowerCase()}
  data-category={category}
  data-view-mode="grid"
>
  <!-- Clickable overlay -->
  <a href={`/blog/${post.slug}/`} class="absolute inset-0 z-10" aria-label={`Lire: ${title}`}></a>

  <!-- Card inner wrapper for flex layout -->
  <div class="card-inner">
    <!-- Image -->
    <div class="card-image relative overflow-hidden border-b-2 border-black">
      <img
        src={image.url}
        alt={image.alt}
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
        loading="lazy"
      />
      <!-- Category badge (grid mode only) -->
      <div class="category-badge-grid absolute top-3 left-3">
        <CategoryBadge category={category} />
      </div>
    </div>

    <!-- Content -->
    <div class="card-content p-5">
      <!-- Category badge (list mode only) -->
      <div class="category-badge-list hidden mb-3">
        <CategoryBadge category={category} />
      </div>

      <!-- Title -->
      <h3 class="card-title text-lg font-bold mb-2 line-clamp-2 group-hover:text-[var(--violet)] transition-colors">
        {title}
      </h3>

      <!-- Meta -->
      <div class="flex items-center gap-3 text-xs text-gray-500 mb-3">
        <time datetime={pubDate.toISOString()}>
          {formatDateShort(pubDate)}
        </time>
        {readingTime && (
          <span class="flex items-center gap-1">
            <i class="ri-time-line"></i>
            {readingTime} min
          </span>
        )}
      </div>

      <!-- Description -->
      <p class="text-gray-600 text-sm line-clamp-2 mb-4">
        {description}
      </p>

      <!-- Tags -->
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-1">
          {tags.slice(0, 3).map((tag) => (
            <span class="px-2 py-0.5 bg-gray-100 text-xs text-gray-500">
              #{tag}
            </span>
          ))}
        </div>
      )}
    </div>
  </div>

  <!-- Bottom accent line on hover -->
  <div class="accent-line absolute bottom-0 left-0 right-0 h-1 bg-[var(--accent)] transform scale-x-0 origin-left group-hover:scale-x-100 transition-transform duration-300"></div>
</article>

<style>
  /* Grid mode (default) */
  .post-card[data-view-mode="grid"] .card-inner {
    display: block;
  }

  .post-card[data-view-mode="grid"] .card-image {
    aspect-ratio: 16 / 9;
  }

  .post-card[data-view-mode="grid"] .card-image img {
    object-fit: cover;
  }

  .post-card[data-view-mode="grid"] .category-badge-grid {
    display: block;
  }

  .post-card[data-view-mode="grid"] .category-badge-list {
    display: none;
  }

  /* List mode */
  .post-card[data-view-mode="list"] .card-inner {
    display: flex;
    flex-direction: row-reverse;
  }

  .post-card[data-view-mode="list"] .card-image {
    flex: 3;
    min-width: 0;
    border-bottom: none;
    border-left: none;
    background-color: #f8f8f8;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .post-card[data-view-mode="list"] .card-image img {
    object-fit: contain;
    max-height: 100%;
    max-width: 100%;
    width: auto;
    height: auto;
  }

  .post-card[data-view-mode="list"] .card-content {
    flex: 2;
    min-width: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .post-card[data-view-mode="list"] .card-title {
    font-size: 1rem;
    line-height: 1.4;
  }

  .post-card[data-view-mode="list"] .category-badge-grid {
    display: none;
  }

  .post-card[data-view-mode="list"] .category-badge-list {
    display: block;
  }

  /* List mode accent line position */
  .post-card[data-view-mode="list"] .accent-line {
    bottom: 0;
    left: 0;
    right: auto;
    width: 4px;
    height: 100%;
    transform: scaleY(0);
    transform-origin: bottom;
  }

  .post-card[data-view-mode="list"]:hover .accent-line {
    transform: scaleY(1);
  }

  /* Responsive: list mode becomes compact on mobile */
  @media (max-width: 640px) {
    .post-card[data-view-mode="list"] .card-content {
      padding: 0.75rem;
    }

    .post-card[data-view-mode="list"] .card-title {
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }
  }
</style>
