---
import logoStar from '../assets/logo-star.svg'
import svgPinkStar from '../assets/pink-star.svg'
import { author } from '../sample'

// Interface typ√©e pour les liens de navigation
interface NavLink {
    name: string;
    path: string;
    target: string;
}

const links: NavLink[] = [
    { name: 'Services', path: '/services/', target: '_self' },
    { name: 'Portfolio', path: '/portfolio/', target: '_self' },
    { name: 'Lab', path: '/lab/', target: '_self' },
    { name: 'Blog', path: '/blog/', target: '_self' },
    { name: 'About', path: '/about/', target: '_self' },
]

const { pathname } = Astro.url
---

<header class="relative border-b-3 p-7 overflow-hidden">
    <img src={svgPinkStar.src} alt="svg" width="80" class="absolute -right-9 -top-4" />
    <img src={svgPinkStar.src} alt="svg" width="80" class="absolute -left-8 -bottom-5 hidden md:block" />


    <div class="flex border-3 border-black bg-white max-w-[360px] md:max-w-3xl m-auto relative z-10">
        <!-- top boxes -->
        <div class="size-2 bg-white border-2 border-black absolute -top-2 -right-2"></div>
        <div class="size-2 bg-white border-2 border-black absolute -top-2 -left-2"></div>

        <!-- bottom boxes -->
        <div class="size-2 bg-white border-2 border-black absolute -bottom-2 -left-2"></div>
        <div class="size-2 bg-white border-2 border-black absolute -bottom-2 -right-2"></div>
    
        <nav class="flex w-full items-center p-2 md:p-0">
            <div class="flex-1 font-bold">
                <a href="/" class="flex items-center gap-2 pl-3 group">
                    <img
                        src={logoStar.src}
                        alt="Jon Labs logo"
                        width="26"
                        class="transition-transform duration-300 group-hover:rotate-12"
                    />
                    <span>{author.nickname}</span>
                </a>
            </div>
            <button
                class="flex md:hidden p-2 focus:ring-2 focus:ring-black focus:outline-none"
                id="menu-open"
                aria-label="Ouvrir le menu de navigation"
                aria-expanded="false"
                aria-controls="menu-content"
            >
                <i class="ri-menu-2-line text-2xl" aria-hidden="true"></i>
            </button>
            <ul class="hidden md:flex items-center">
                {links.map((item) => (
                    <li class="border-l-2 border-black p-2 py-3">
                        <a
                            href={item.path}
                            target={item.target}
                            class={`
                                relative flex items-center whitespace-nowrap px-1
                                before:absolute before:left-0 before:bottom-1
                                before:h-[8px] before:w-0 before:bg-[var(--accent)]
                                before:transition-all before:duration-300
                                hover:before:w-full
                                ${pathname === item.path ? 'bg-[var(--accent)]' : ''}
                            `}
                        >
                            <span class="relative z-10">{item.name}</span>
                        </a>
                    </li>
                ))}
                {/* CTA Contact avec effet "stamp" */}
                <li class="border-l-2 border-black p-2 py-2 flex items-center">
                    <a
                        href="/contact/"
                        class="
                            bg-[var(--blue)] border-2 border-black
                            px-4 py-1.5
                            font-medium text-sm
                            shadow-[3px_3px_0px_rgba(0,0,0,1)]
                            transition-all duration-200
                            hover:bg-[var(--yellow)]
                            hover:shadow-[1px_1px_0px_rgba(0,0,0,1)]
                            hover:translate-x-[2px] hover:translate-y-[2px]
                            focus:ring-2 focus:ring-black focus:ring-offset-2 focus:outline-none
                        "
                    >
                        Contact
                    </a>
                </li>
            </ul>
        </nav>
    </div>
  </header>

  <div
    class="block md:hidden fixed left-0 top-0 h-full w-full bg-white z-20 p-3 transition-all duration-300 -translate-x-[100%]"
    id="menu-content"
    role="dialog"
    aria-modal="true"
    aria-label="Menu de navigation"
  >
    <div class="flex p-6 border-b-2 border-black">
        <h3 class="flex-1 font-bold uppercase tracking-wider">Menu</h3>
        <button
            id="menu-close"
            aria-label="Fermer le menu"
            class="p-1 focus:ring-2 focus:ring-black focus:outline-none"
        >
            <i class="ri-close-line text-3xl" aria-hidden="true"></i>
        </button>
    </div>
    <nav>
        <ul class="flex flex-col justify-center items-center gap-2 mt-8">
            {links.map((item) => (
                <li class="py-2 w-full text-center">
                    <a
                        href={item.path}
                        target={item.target}
                        class={`
                            block p-3 text-2xl font-bold
                            transition-colors duration-200
                            hover:bg-[var(--accent)]
                            ${pathname === item.path ? 'bg-[var(--accent)]' : ''}
                        `}
                    >
                        {item.name}
                    </a>
                </li>
            ))}
            {/* CTA Contact mobile */}
            <li class="py-6 mt-4">
                <a
                    href="/contact/"
                    class="
                        inline-block
                        bg-[var(--blue)] border-3 border-black
                        px-10 py-4
                        text-xl font-bold
                        shadow-[4px_4px_0px_rgba(0,0,0,1)]
                        transition-all duration-200
                        hover:bg-[var(--yellow)]
                        hover:shadow-[2px_2px_0px_rgba(0,0,0,1)]
                        hover:translate-x-[2px] hover:translate-y-[2px]
                    "
                >
                    Contact
                </a>
            </li>
        </ul>
    </nav>
  </div>


<script>
document.addEventListener('DOMContentLoaded', function () {
    const menuContent = document.querySelector('#menu-content');
    const menuOpen = document.querySelector('#menu-open');
    const menuClose = document.querySelector('#menu-close');

    function openMenu() {
        menuContent?.classList.remove('-translate-x-[100%]');
        menuOpen?.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
        menuContent?.classList.add('-translate-x-[100%]');
        menuOpen?.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
    }

    menuOpen?.addEventListener('click', (e) => {
        e.preventDefault();
        openMenu();
    });

    menuClose?.addEventListener('click', (e) => {
        e.preventDefault();
        closeMenu();
    });

    // Fermer au clic sur un lien
    menuContent?.querySelectorAll('a').forEach(item => {
        item.addEventListener('click', closeMenu);
    });

    // Fermer avec la touche Escape
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMenu();
    });
});
</script>