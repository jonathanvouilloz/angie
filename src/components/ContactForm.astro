---
// ContactForm.astro - Formulaire brutaliste avec Web3Forms (AJAX)
---

<div class="contact-form-container relative">
    <!-- Form card -->
    <form
        class="bg-white border-3 border-black p-6 md:p-8 shadow-[6px_6px_0px_rgba(0,0,0,1)] relative"
        id="contact-form"
    >
        <!-- Corner boxes -->
        <div class="absolute -top-1.5 -left-1.5 w-3 h-3 bg-[var(--blue)] border-2 border-black"></div>
        <div class="absolute -top-1.5 -right-1.5 w-3 h-3 bg-[var(--blue)] border-2 border-black"></div>
        <div class="absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-[var(--blue)] border-2 border-black"></div>
        <div class="absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-[var(--blue)] border-2 border-black"></div>

        <!-- Hidden fields for Web3Forms -->
        <input type="hidden" name="access_key" value="2964b7b3-2e2d-454b-a792-967518d5788b">
        <input type="hidden" name="subject" value="Nouveau message - Jon Labs">
        <input type="hidden" name="from_name" value="Jon Labs Contact">

        <!-- Honeypot spam protection -->
        <input type="checkbox" name="botcheck" class="hidden" style="display: none;">

        <!-- Form header -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-2">Lancer une expérience</h2>
            <p class="text-gray-600">Remplissez le formulaire et je vous recontacte rapidement.</p>
        </div>

        <!-- Form fields -->
        <div class="space-y-6">

            <!-- Field 01: Nom -->
            <div class="form-field">
                <label for="name" class="flex items-center gap-2 text-sm font-medium mb-2">
                    <span class="font-mono text-xs text-gray-400">01</span>
                    Votre nom <span class="text-red-500">*</span>
                </label>
                <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    placeholder="Jonathan Vouilloz"
                    class="
                        w-full px-4 py-3
                        border-2 border-black
                        bg-white
                        text-lg
                        placeholder:text-gray-400
                        focus:outline-none focus:ring-2 focus:ring-[var(--blue)] focus:ring-offset-2
                        transition-all
                    "
                />
            </div>

            <!-- Field 02: Email -->
            <div class="form-field">
                <label for="email" class="flex items-center gap-2 text-sm font-medium mb-2">
                    <span class="font-mono text-xs text-gray-400">02</span>
                    Votre email <span class="text-red-500">*</span>
                </label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    placeholder="vous@exemple.ch"
                    class="
                        w-full px-4 py-3
                        border-2 border-black
                        bg-white
                        text-lg
                        placeholder:text-gray-400
                        focus:outline-none focus:ring-2 focus:ring-[var(--blue)] focus:ring-offset-2
                        transition-all
                    "
                />
            </div>

            <!-- Field 03: Type de projet -->
            <div class="form-field">
                <label for="project-type" class="flex items-center gap-2 text-sm font-medium mb-2">
                    <span class="font-mono text-xs text-gray-400">03</span>
                    Type de projet
                </label>
                <div class="relative">
                    <select
                        id="project-type"
                        name="project_type"
                        class="
                            w-full px-4 py-3
                            border-2 border-black
                            bg-white
                            text-lg
                            appearance-none
                            cursor-pointer
                            focus:outline-none focus:ring-2 focus:ring-[var(--blue)] focus:ring-offset-2
                            transition-all
                        "
                    >
                        <option value="">Sélectionnez une option</option>
                        <option value="web-dev">Développement Web</option>
                        <option value="automation">Automatisation & Processus</option>
                        <option value="custom-app">Application Sur-Mesure</option>
                        <option value="other">Autre / Je ne sais pas encore</option>
                    </select>
                    <i class="ri-arrow-down-s-line absolute right-4 top-1/2 -translate-y-1/2 text-xl pointer-events-none"></i>
                </div>
            </div>

            <!-- Field 04: Message -->
            <div class="form-field">
                <label for="message" class="flex items-center gap-2 text-sm font-medium mb-2">
                    <span class="font-mono text-xs text-gray-400">04</span>
                    Votre message <span class="text-red-500">*</span>
                </label>
                <textarea
                    id="message"
                    name="message"
                    required
                    rows="5"
                    placeholder="Décrivez votre projet, vos besoins, vos idées..."
                    class="
                        w-full px-4 py-3
                        border-2 border-black
                        bg-white
                        text-lg
                        placeholder:text-gray-400
                        resize-none
                        focus:outline-none focus:ring-2 focus:ring-[var(--blue)] focus:ring-offset-2
                        transition-all
                    "
                ></textarea>
            </div>

            <!-- Field 05: Checkbox -->
            <div class="form-field">
                <label class="flex items-start gap-3 cursor-pointer group">
                    <input
                        type="checkbox"
                        name="consent"
                        required
                        class="
                            mt-1
                            w-5 h-5
                            border-2 border-black
                            appearance-none
                            cursor-pointer
                            checked:bg-[var(--blue)]
                            checked:border-black
                            relative
                            transition-all
                        "
                    />
                    <span class="text-sm text-gray-600 group-hover:text-black transition-colors">
                        J'accepte d'être contacté par email concernant ma demande. <span class="text-red-500">*</span>
                    </span>
                </label>
            </div>

            <!-- Submit button -->
            <div class="pt-4">
                <button
                    type="submit"
                    class="
                        submit-btn
                        w-full md:w-auto
                        bg-[var(--blue)]
                        border-2 border-black
                        px-8 py-4
                        text-lg font-bold
                        shadow-[4px_4px_0px_rgba(0,0,0,1)]
                        transition-all duration-200
                        hover:bg-[var(--yellow)]
                        hover:shadow-[2px_2px_0px_rgba(0,0,0,1)]
                        hover:translate-x-[2px] hover:translate-y-[2px]
                        focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2
                        flex items-center justify-center gap-3
                    "
                >
                    <span>Envoyer le message</span>
                    <i class="ri-send-plane-line text-xl"></i>
                </button>
            </div>
        </div>
    </form>
</div>

<style>
    /* Custom checkbox checkmark */
    input[type="checkbox"]:checked::after {
        content: '';
        position: absolute;
        left: 5px;
        top: 1px;
        width: 6px;
        height: 12px;
        border: solid black;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }

    /* Submit button loading state */
    .submit-btn.loading {
        pointer-events: none;
        opacity: 0.7;
    }

    .submit-btn.loading i {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
</style>

<script>
    // AJAX Form submission
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitBtn = form?.querySelector('.submit-btn') as HTMLButtonElement;
    const btnText = submitBtn?.querySelector('span');
    const btnIcon = submitBtn?.querySelector('i');

    form?.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Loading state
        if (submitBtn) {
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            if (btnText) btnText.textContent = 'Envoi en cours...';
            if (btnIcon) btnIcon.className = 'ri-loader-4-line text-xl animate-spin';
        }

        try {
            const formData = new FormData(form);
            const response = await fetch('https://api.web3forms.com/submit', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                // Show success modal
                const modal = document.getElementById('contact-success');
                if (modal) modal.classList.remove('hidden');

                // Reset form
                form.reset();
            } else {
                alert('Erreur lors de l\'envoi. Veuillez réessayer.');
            }
        } catch (error) {
            alert('Erreur de connexion. Veuillez réessayer.');
        } finally {
            // Reset button
            if (submitBtn) {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
                if (btnText) btnText.textContent = 'Envoyer le message';
                if (btnIcon) btnIcon.className = 'ri-send-plane-line text-xl';
            }
        }
    });
</script>
