---
// ChatAnimation.astro - Fausse conversation brutaliste
---

<div class="chat-container relative w-full max-w-md">
    <!-- Chat window -->
    <div class="bg-white border-3 border-black shadow-[6px_6px_0px_rgba(0,0,0,1)] relative overflow-hidden">
        <!-- Corner boxes -->
        <div class="absolute -top-1.5 -left-1.5 w-3 h-3 bg-[var(--blue)] border-2 border-black z-10"></div>
        <div class="absolute -top-1.5 -right-1.5 w-3 h-3 bg-[var(--blue)] border-2 border-black z-10"></div>
        <div class="absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-[var(--blue)] border-2 border-black z-10"></div>
        <div class="absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-[var(--blue)] border-2 border-black z-10"></div>

        <!-- Header -->
        <div class="flex items-center gap-3 px-4 py-3 border-b-2 border-black bg-gray-50">
            <!-- Traffic lights -->
            <div class="flex gap-1.5">
                <span class="w-3 h-3 rounded-full bg-red-400 border border-red-500"></span>
                <span class="w-3 h-3 rounded-full bg-yellow-400 border border-yellow-500"></span>
                <span class="w-3 h-3 rounded-full bg-green-400 border border-green-500"></span>
            </div>
            <!-- Contact name -->
            <div class="flex-1 text-center">
                <span class="font-bold text-sm">Jonathan V.</span>
            </div>
            <!-- Online indicator -->
            <div class="flex items-center gap-1.5">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-xs text-gray-500">en ligne</span>
            </div>
        </div>

        <!-- Messages container -->
        <div class="chat-messages p-4 space-y-3 h-[300px] overflow-y-auto scroll-smooth" id="chat-messages">
            <!-- Messages will be inserted here by JS -->
        </div>

        <!-- Input bar (decorative) -->
        <div class="flex items-center gap-2 px-4 py-3 border-t-2 border-black bg-gray-50">
            <div class="flex-1 px-3 py-2 bg-white border-2 border-black text-sm text-gray-400">
                √âcrire un message...
            </div>
            <button class="w-10 h-10 bg-[var(--blue)] border-2 border-black flex items-center justify-center">
                <i class="ri-send-plane-fill"></i>
            </button>
        </div>
    </div>
</div>

<style>
    /* Hide scrollbar but keep functionality */
    .chat-messages {
        scrollbar-width: thin;
        scrollbar-color: #d1d5db transparent;
    }

    .chat-messages::-webkit-scrollbar {
        width: 4px;
    }

    .chat-messages::-webkit-scrollbar-track {
        background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb {
        background-color: #d1d5db;
        border-radius: 2px;
    }

    /* Message animations */
    .chat-message {
        opacity: 0;
        transform: translateY(10px);
        animation: messageAppear 0.4s ease-out forwards;
    }

    @keyframes messageAppear {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Typing indicator dots */
    .typing-dot {
        animation: typingBounce 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingBounce {
        0%, 80%, 100% {
            transform: translateY(0);
            opacity: 0.4;
        }
        40% {
            transform: translateY(-4px);
            opacity: 1;
        }
    }
</style>

<script>
    // Plusieurs conversations qui tournent
    const conversations = [
        // Conversation 1: App de gestion
        [
            { from: 'client', text: "Hey Jonathan ! üëã" },
            { from: 'client', text: "J'ai une id√©e d'app depuis des mois..." },
            { from: 'jon', text: "Salut ! Raconte-moi ton projet üß™" },
            { from: 'client', text: "C'est pour automatiser la gestion de mon √©quipe" },
            { from: 'client', text: "On perd tellement de temps avec Excel..." },
            { from: 'jon', text: "Je vois exactement le probl√®me !" },
            { from: 'jon', text: "On peut cr√©er un outil sur-mesure" },
            { from: 'client', text: "C'est vraiment faisable ? üòÆ" },
            { from: 'jon', text: "Absolument. On commence par un MVP simple" },
            { from: 'jon', text: "Tu es dispo pour en discuter ?" },
            { from: 'typing', text: '' }
        ],
        // Conversation 2: Site web
        [
            { from: 'client', text: "Bonjour Jonathan !" },
            { from: 'client', text: "Je lance mon activit√© de coach" },
            { from: 'jon', text: "F√©licitations ! üéâ" },
            { from: 'client', text: "J'aurais besoin d'un site web pro" },
            { from: 'client', text: "Mais je n'y connais rien en tech..." },
            { from: 'jon', text: "Pas de souci, je g√®re tout de A √† Z" },
            { from: 'jon', text: "Tu te concentres sur ton business" },
            { from: 'client', text: "Parfait ! Tu as des exemples ?" },
            { from: 'jon', text: "Je t'envoie mon portfolio üìÅ" },
            { from: 'typing', text: '' }
        ],
        // Conversation 3: Automatisation
        [
            { from: 'client', text: "Salut ! Une question rapide" },
            { from: 'jon', text: "Je t'√©coute üëÇ" },
            { from: 'client', text: "Je passe 2h/jour √† envoyer des emails..." },
            { from: 'client', text: "Y'a moyen d'automatiser √ßa ?" },
            { from: 'jon', text: "Oh oui, c'est ma sp√©cialit√© !" },
            { from: 'jon', text: "Make + Zapier = magie ü™Ñ" },
            { from: 'client', text: "√áa me changerait la vie" },
            { from: 'jon', text: "On peut r√©duire √ßa √† 10 min/jour" },
            { from: 'client', text: "S√©rieux ?! Quand peut-on en parler ?" },
            { from: 'jon', text: "Je suis dispo cette semaine üìÖ" },
            { from: 'typing', text: '' }
        ]
    ];

    const container = document.getElementById('chat-messages');
    let currentConversation = 0;

    function createMessageElement(msg: { from: string; text: string }) {
        const div = document.createElement('div');
        div.className = 'chat-message';

        if (msg.from === 'typing') {
            div.className += ' flex justify-end';
            div.innerHTML = `
                <div class="inline-flex items-center gap-1 px-4 py-2 bg-gray-100 border-2 border-black">
                    <span class="typing-dot w-2 h-2 bg-gray-500 rounded-full"></span>
                    <span class="typing-dot w-2 h-2 bg-gray-500 rounded-full"></span>
                    <span class="typing-dot w-2 h-2 bg-gray-500 rounded-full"></span>
                </div>
            `;
        } else if (msg.from === 'client') {
            div.className += ' flex justify-end';
            div.innerHTML = `
                <div class="max-w-[85%] px-4 py-2 bg-gray-100 border-2 border-black shadow-[2px_2px_0px_rgba(0,0,0,0.8)]">
                    <p class="text-sm">${msg.text}</p>
                </div>
            `;
        } else {
            div.className += ' flex justify-start';
            div.innerHTML = `
                <div class="max-w-[85%] px-4 py-2 bg-[var(--blue)] border-2 border-black shadow-[2px_2px_0px_rgba(0,0,0,0.8)]">
                    <p class="text-sm">${msg.text}</p>
                </div>
            `;
        }

        return div;
    }

    function showMessages() {
        if (!container) return;

        // Clear previous messages
        container.innerHTML = '';

        const messages = conversations[currentConversation];

        // Add messages with delays
        messages.forEach((msg, index) => {
            const delay = index * 1200; // 1.2s between each message
            setTimeout(() => {
                const element = createMessageElement(msg);
                container.appendChild(element);
                // Smooth scroll to bottom
                container.scrollTo({
                    top: container.scrollHeight,
                    behavior: 'smooth'
                });
            }, delay);
        });

        // Switch to next conversation and restart
        const totalDuration = messages.length * 1200 + 3000; // +3s pause at end
        setTimeout(() => {
            currentConversation = (currentConversation + 1) % conversations.length;
            showMessages();
        }, totalDuration);
    }

    // Start animation when visible
    const chatContainer = document.querySelector('.chat-container');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                showMessages();
                observer.disconnect();
            }
        });
    }, { threshold: 0.3 });

    if (chatContainer) {
        observer.observe(chatContainer);
    }
</script>
